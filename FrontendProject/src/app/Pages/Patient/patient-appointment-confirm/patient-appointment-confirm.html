<div class="page-container">
  <div class="table-header">
    <h2>Appointment Confirmation</h2>

  </div>


  <div class="filter-section">
    <div class="filter-group">
      <label>Filter by Status:</label>
      <select [(ngModel)]="filterStatus" (change)="applyFilter()" class="filter-input">
        <option value="">All Appointments</option>
        <option value="Pending">Pending</option>
        <option value="Confirmed">Confirmed</option>
        <option value="Cancelled">Cancelled</option>
        <option value="Completed">Completed</option>
      </select>
    </div>
    <div class="filter-group">
      <label>Search Patient:</label>
      <input 
        type="text" 
        [(ngModel)]="searchTerm" 
        (input)="applyFilter()"
        placeholder="Search by patient name..."
        class="filter-input">
    </div>
    <div class="filter-group">
      <label>Filter by Date:</label>
      <input 
        type="date" 
        [(ngModel)]="filterDate" 
        (change)="applyFilter()"
        class="filter-input">
    </div>
  </div>

  <table class="list-table" *ngIf="filteredAppointments.length > 0; else noAppointments">
    <thead>
      <tr>
        <th>ID</th>
        <th>Patient Name</th>
        <th>Doctor</th>
        <th>Department</th>
        <th>Date</th>
        <th>Time</th>
        <th>Reason</th>
        <th>Status</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let appointment of filteredAppointments">
        <td>{{ appointment.id }}</td>
        <td>{{ appointment.patientName || 'N/A' }}</td>
        <td>{{ appointment.doctorName || 'N/A' }}</td>
        <td>{{ appointment.departmentName || 'N/A' }}</td>
        <td>{{ appointment.preferredDate | date:'MMM dd, yyyy' }}</td>
        <td>{{ appointment.availableTimeSlots || 'N/A' }}</td>
        <td>
          <span class="reason-text">{{ 
            appointment.reasonforVisit 
              ? (appointment.reasonforVisit.length > 30 
                  ? (appointment.reasonforVisit | slice:0:30) + '...' 
                  : appointment.reasonforVisit)
              : 'N/A' 
          }}</span>
        </td>
        <td>
          <span [ngClass]="{
            'status-confirmed': appointment.status === 'Confirmed',
            'status-completed': appointment.status === 'Completed',
            'status-pending': appointment.status === 'Pending',
            'status-cancelled': appointment.status === 'Cancelled'
          }">
            {{ appointment.status || 'Pending' }}
          </span>
        </td>
        <td class="actions-cell">
          <button 
            class="edit" 
            (click)="confirmAppointment(appointment)"
            [disabled]="appointment.status !== 'Pending'"
            [class.disabled]="appointment.status !== 'Pending'"
            *ngIf="appointment.status === 'Pending'">
            ‚úì Confirm
          </button>
          
          <button 
            class="cancel-btn" 
            (click)="cancelAppointment(appointment)"
            [disabled]="appointment.status !== 'Pending'"
            [class.disabled]="appointment.status !== 'Pending'"
            *ngIf="appointment.status === 'Pending'">
            ‚úó Cancel
          </button>
          
          <button 
            class="delete" 
            (click)="viewDetails(appointment)">
            üëÅÔ∏è View
          </button>
        </td>
      </tr>
    </tbody>
  </table>

  <ng-template #noAppointments>
    <div class="no-data">
      <p>No appointments found.</p>
    </div>
  </ng-template>


  <div class="summary-section" *ngIf="appointments.length > 0">
    <div class="summary-card">
      <span class="summary-label">Total Appointments:</span>
      <span class="summary-value">{{ appointments.length }}</span>
    </div>
    <div class="summary-card pending-card">
      <span class="summary-label">Pending:</span>
      <span class="summary-value pending">{{ getCountByStatus('Pending') }}</span>
    </div>
    <div class="summary-card confirmed-card">
      <span class="summary-label">Confirmed:</span>
      <span class="summary-value confirmed">{{ getCountByStatus('Confirmed') }}</span>
    </div>
    <div class="summary-card cancelled-card">
      <span class="summary-label">Cancelled:</span>
      <span class="summary-value cancelled">{{ getCountByStatus('Cancelled') }}</span>
    </div>
    <div class="summary-card completed-card">
      <span class="summary-label">Completed:</span>
      <span class="summary-value completed">{{ getCountByStatus('Completed') }}</span>
    </div>
  </div>
</div>